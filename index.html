<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Grafik 4-brygadowy</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />

    <!-- Dla Chrome & Android -->
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- Dla Safari (wciąż wymagane, mimo ostrzeżeń Chrome) -->
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Grafik" />
    <link rel="apple-touch-icon" href="icon-192.png" />

    <meta name="theme-color" content="#020617" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />

    <!-- STYLES -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="app-wrapper">
      <div id="generator" class="generator-container">
        <div class="generator-header">
          <div>
            <h2>Grafik pracy</h2>
            <p class="subtitle">System 4-brygadowy – cykl 16-dniowy</p>
          </div>
          <span class="badge-cycle">I / II / N / W</span>
        </div>

        <div id="calendarSection" class="section" style="display: none">
          <h3 class="section-title">Kalendarz</h3>

          <div class="month-nav">
            <button id="btnPrevMonth" class="nav-btn">◀</button>
            <span id="monthLabel" class="month-label"></span>
            <button id="btnNextMonth" class="nav-btn">▶</button>
          </div>

          <div class="calendar-wrapper">
            <table class="kalendarz">
              <thead>
                <tr>
                  <th>Pn</th>
                  <th>Wt</th>
                  <th>Śr</th>
                  <th>Cz</th>
                  <th>Pt</th>
                  <th>So</th>
                  <th>Nd</th>
                </tr>
              </thead>
              <tbody id="calendarBody"></tbody>
            </table>

            <div class="legenda">
              <span class="legend-item">
                <span class="legend-color zmiana-I"></span> I zmiana
              </span>
              <span class="legend-item">
                <span class="legend-color zmiana-II"></span> II zmiana
              </span>
              <span class="legend-item">
                <span class="legend-color zmiana-N"></span> III zmiana
              </span>
              <span class="legend-item">
                <span class="legend-color zmiana-W"></span> Wolne
              </span>
              <span class="legend-item">
                <span class="legend-color zmiana-L4"></span> L4
              </span>
              <span class="legend-item">
                <span class="legend-color zmiana-UW"></span> Urlop (UW)
              </span>
            </div>
          </div>
        </div>
        <div id="monthSummary" class="month-summary">
          <h4 class="section-title">Podsumowanie miesiąca</h4>
          <div id="monthSummaryContent" class="month-summary-content">
            Brak danych – wygeneruj grafik.
          </div>
        </div>

        <div class="year-summary-actions">
          <button id="btnYearSummary" class="btn-secondary btn-year-summary">
            Podsumowanie roku
          </button>
        </div>

        <!-- NOWA SEKCJA -->
        <div id="yearSummary" class="year-summary" style="display: none">
          <h4 class="section-title">Podsumowanie roku</h4>
          <div id="yearSummaryContent" class="year-summary-content"></div>
        </div>

        <div id="emptyInfo" class="section empty-info">
          <p>
            Ustaw powyżej 4 dni i kliknij
            <strong>„Generuj grafik”</strong>, aby zobaczyć kalendarz.
          </p>
        </div>
        <div class="section" id="step1Section">
          <h3 class="section-title">Ustawienia grafiku</h3>
          <p class="hint">
            Na początku ustaw 4 znane dni oraz kierunek zmian. Po wygenerowaniu
            grafiku daty startowe zostaną ukryte, ale dalej możesz zmieniać
            kierunek i przeliczać grafik. Notatki zawsze zostają.
          </p>

          <!-- Kierunek zmian -->
          <div class="field" style="max-width: 260px; margin-bottom: 8px">
            <label for="direction">Kierunek zmian</label>
            <select id="direction">
              <option value="321">3 → 2 → 1 (N → II → I)</option>
              <option value="123">1 → 2 → 3 (I → II → N)</option>
            </select>
          </div>

          <!-- 4 dni wejściowe (do ukrycia po wygenerowaniu) -->
          <div id="dniWejscioweWrapper">
            <h4 class="section-title" style="margin-top: 8px">
              4 znane dni (tylko przy pierwszym ustawieniu)
            </h4>
            <div class="dni-grid">
              <div class="wejsciowy-wiersz" data-index="0">
                <div class="field">
                  <label>Data #1</label>
                  <input type="date" id="data-0" />
                </div>
                <div class="field">
                  <label>Typ zmiany</label>
                  <select id="typ-0">
                    <option value="">— wybierz —</option>
                    <option value="I">I</option>
                    <option value="II">II</option>
                    <option value="N">N</option>
                    <option value="W">W</option>
                  </select>
                </div>
              </div>

              <div class="wejsciowy-wiersz" data-index="1">
                <div class="field">
                  <label>Data #2</label>
                  <input type="date" id="data-1" />
                </div>
                <div class="field">
                  <label>Typ zmiany</label>
                  <select id="typ-1">
                    <option value="">— wybierz —</option>
                    <option value="I">I</option>
                    <option value="II">II</option>
                    <option value="N">N</option>
                    <option value="W">W</option>
                  </select>
                </div>
              </div>

              <div class="wejsciowy-wiersz" data-index="2">
                <div class="field">
                  <label>Data #3</label>
                  <input type="date" id="data-2" />
                </div>
                <div class="field">
                  <label>Typ zmiany</label>
                  <select id="typ-2">
                    <option value="">— wybierz —</option>
                    <option value="I">I</option>
                    <option value="II">II</option>
                    <option value="N">N</option>
                    <option value="W">W</option>
                  </select>
                </div>
              </div>

              <div class="wejsciowy-wiersz" data-index="3">
                <div class="field">
                  <label>Data #4</label>
                  <input type="date" id="data-3" />
                </div>
                <div class="field">
                  <label>Typ zmiany</label>
                  <select id="typ-3">
                    <option value="">— wybierz —</option>
                    <option value="I">I</option>
                    <option value="II">II</option>
                    <option value="N">N</option>
                    <option value="W">W</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="buttons-row">
            <button id="btnGeneruj" class="btn-primary">Generuj grafik</button>
            <button id="btnRecalc" class="btn-primary" style="display: none">
              Przelicz grafik ponownie
            </button>
            <button id="btnReset" class="btn-secondary btn-reset">
              Resetuj grafik (od zera)
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL EDYCJI DNIA -->
    <div id="dayModalBackdrop" class="modal-backdrop">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title" id="modalTitle">Dzień</div>
          <button class="modal-close" id="modalCloseBtn">✕</button>
        </div>

        <div class="modal-body">
          <!-- ZWYKŁA NOTATKA (jak wcześniej) -->
          <div class="field">
            <label for="modalTyp">Typ dnia</label>
            <select id="modalTyp">
              <option value="">(domyślny z grafiku)</option>
              <option value="I">I</option>
              <option value="II">II</option>
              <option value="N">N</option>
              <option value="W">W</option>
              <option value="L4">L4</option>
              <option value="UW">UW (urlop)</option>
              <option value="INNE">Inne</option>
            </select>
          </div>

          <div class="field">
            <label for="modalNotka">Notatka (np. „lekarz 8:00”)</label>
            <textarea id="modalNotka" placeholder="Wpisz notatkę..."></textarea>
          </div>
        </div>
        <!-- HASŁO – odblokowuje ukrytą sekcję z punktami -->
        <div class="field">
          <label for="modalPassword"></label>
          <input type="password" id="modalPassword" placeholder="Wpisz kod" />
        </div>

        <!-- UKRYTA SEKCJA Z PUNKTAMI -->
        <div id="pointsSection" class="points-section" style="display: none">
          <div class="field">
            <label for="modalPktAparat">Punkty za aparat</label>
            <input
              type="number"
              id="modalPktAparat"
              min="0"
              step="1"
              inputmode="numeric"
            />
          </div>
          <div class="field">
            <label for="modalPktZadanie">Punkty za zadanie</label>
            <input
              type="number"
              id="modalPktZadanie"
              min="0"
              step="1"
              inputmode="numeric"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" id="modalClearBtn">
            Wyczyść zmiany
          </button>
          <button class="btn-save" id="modalSaveBtn">Zapisz</button>
        </div>
      </div>
    </div>
    <!-- BANER AKTUALIZACJI -->
    <div id="updateBanner" class="update-banner" style="display: none">
      <span class="update-banner-text">
        Dostępna jest nowa wersja grafiku.
      </span>
      <button id="updateReloadBtn" class="update-banner-btn">Odśwież</button>
    </div>
    <!-- SCRIPTS -->
    <script src="app.js"></script>
  </body>
</html>
